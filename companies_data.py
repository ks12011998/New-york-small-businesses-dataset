# -*- coding: utf-8 -*-
"""Untitled

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1KIvEX523UWmXWs1St2r5ys2bgPoa52YS
"""

#BeautifulSoup Library for scrapping data
#Importing the required
from bs4 import BeautifulSoup
import requests
import urllib.request
import shutil

#from the webpage NY Biz list
url = "http://nybizlist.com/nyc-small-business-directory.htm"
response = requests.get(url)
#request using url to the server
soup = BeautifulSoup(response.text, 'html.parser')
#Extracting a particular class from the page
lister_list = soup.findChildren('p', {"class" : 'featured'})
lister_list

#Extracting company name from the page
Company = []
for i in range(len(lister_list)):
  li = lister_list[i].select('img')
  for link in li:
    print(link.get('alt'))
    Company.append(link.get('alt'))
    

# for i in range(len(lister_list)):
#   Company.append(lister_list[i].select('strong')[0].text)

#Importing the required
import pandas as pd
df = pd.DataFrame()
df['Companies'] = Company
df

#Extracting email from the webpage
Email = []
for i in range(len(lister_list)):
  li = lister_list[i].select('a')[0].text
  print(li)
  Email.append(li)

df['Email'] = Email

df

#Extracting services of the particular company
Description = []
# li = lister_list[1].select('strong')
# li[0].next_sibling
# li = lister_list[0].select('strong')
for i in range(len(lister_list)):
  li = lister_list[i].select('strong')
  print(li[0].next_sibling)
  Description.append(li[0].next_sibling)

df['Description'] = Description
df

#Extracting  phone numbers from the particular company
Phone = []
Description = []
# li = lister_list[0].select('a')
# print(li[1].previous_sibling)

print(lister_list[0].select('br')[0].next_sibling.next_sibling.next_sibling.next_sibling.next_sibling)
for i in range(len(lister_list)):

  print(lister_list[i].select('br')[0].next_sibling.next_sibling.next_sibling.next_sibling.next_sibling)
  Phone.append(lister_list[i].select('br')[0].next_sibling.next_sibling.next_sibling.next_sibling.next_sibling)

import re
regex = '(?:(?:\+?([1-9]|[0-9][0-9]|[0-9][0-9][0-9])\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([0-9][1-9]|[0-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?'
match = re.findall(regex,lister_list[0].text)
match[0]
phone= ""
for i in  range(len(match[0])):
  if len(match[0][i])>0:
    phone+= match[0][i]
phone

phone_list = []

regex = '(?:(?:\+?([1-9]|[0-9][0-9]|[0-9][0-9][0-9])\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([0-9][1-9]|[0-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?'
for i in range(len(lister_list)):
  match = re.findall(regex,lister_list[i].text)
  if match:
    match[0]
    phone= ""
    for i in  range(len(match[0])):
      if len(match[0][i])>0:
        phone+= match[0][i]
    phone_list.append(phone)
  else:
    phone_list.append("Not found")

phone_list

import pandas as pd
df = pd.read_csv('/content/drive/My Drive/final_data.csv')

df['Phone'] = phone_list

df

df.to_csv('final_data.csv',index=False)

df

df = pd.read_csv('/content/drive/My Drive/final_data.csv')

df

#Formatting data to clean representation using regular expression
import re
for i in range(len(df)):
  s = df['Email'][i]
  df['Email'][i]= re.sub('\s+',' ',s)

df['Email']

df

# s = df['Description'][0]
# re.sub('\s+',' ',s)


for i in range(len(df)):
  s = df['Description'][i]
  df['Description'][i] = re.sub('\s+',' ',s)

df

for i in range(len(df)):
  s = df['Details'][i]
  df['Details'][i] = re.sub('\s+',' ',s)

df

df.to_csv('modified.csv',index=False)

#Extracting location of the particular company 

lister_list[0].select('a')[1].previous_sibling

lister_list[2].select('a')

Location_list = []
for i in range(len(lister_list)):
  li = lister_list[i].select('a')   
  if len(li)==1:
    li = li[0].next_sibling
    prev= ""
    while li:
      prev = li
      li = li.next_sibling
    location = prev
  else:
    location = li[1].previous_sibling

  print(location)  
  Location_list.append(location)

len(Location_list)

df['Location'] = Location_list
df

#formatting location
s= df['Location'][0]
re.sub('\s+',' ',s)

for i in range(len(df)):
  s = df['Location'][i]
  df['Location'][i] = re.sub('\s+',' ',s)
  print(df['Location'][i])

df

df.to_csv('modified1.csv',index=False)

df=df.rename(columns = {'Description':'Services'})
df

#Saving the final csv file
df.to_csv('modified2.csv',index=False)